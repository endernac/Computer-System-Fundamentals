#! /usr/bin/env bash

# System tests for postfix calculator (can test both C and asm versions)

# Check usage
if [ $# -ne 1 ]; then
	echo "Usage: ./sysTests.sh <exe name>"
	echo "  <exeName> should be './cPostfixCalc' or './asmPostfixCalc'"
	exit 1
fi

# Get the executable to test
exe="$1"

# Variables to keep track of test passed/attempted
numPassed=0
numAttempted=0

# Function testing that a postfix expression yields the expected result
expect() {
	local expected="$1"
	local expr="$2"

	if ./runTest.rb "$exe" "$expected" "$expr"; then
		numPassed=$(expr $numPassed + 1)
	fi
	numAttempted=$(expr $numAttempted + 1)
}

# Function testing that an invalid postfix expression yields an error
expect_error() {
	local expr="$1"

	if ./runTest.rb "$exe" "ERROR" "$expr"; then
		numPassed=$(expr $numPassed + 1)
	fi
	numAttempted=$(expr $numAttempted + 1)
}

#######################################################################
# Tests go here
#######################################################################

expect 5 '2 3 +'
expect 42 '6 7 *'
expect 42 '6 6 6 6 6 6 6 + + + + + +'
expect 7 '13 18 15 * 9 * 6 5 + / - 5 / 1 4 / 6 1 20 * 1 8 * * 18 / * + +'
expect -211 '2 15 16 + 18 + 7 19 + 5 5 * + / 20 4 18 + 11 * - + + 9 3 16 10 + 2 18 - + 1 12 * 3 11 + / * * - +'
expect 13960 '13 13 6 20 + * 17 17 * 3 16 + + * 16 12 / 1 5 * + 10 17 * 4 11 * * - - 8 / +'
expect 233590 '18 7 - 5 - 16 18 * 15 + / 19 2 * 10 4 + / 19 / + 10 15 - 14 11 * + 4 10 + 9 8 * + + 3 3 * 16 19 - * 5 4 * 6 13 * + + * + 14 *'
expect 185176 '11 20 20 * 18 - 8 15 - 1 3 * + * + 5 8 * 14 / 11 * 5 1 / 20 5 * / 6 7 + 20 14 + - + + * 4 11 * 6 18 * * 5 2 + 4 * + 5 4 + 6 16 - + 6 - - 13 3 * * +'
expect -2075759972 '12 13 * 1 20 * + 7 15 * 14 5 * + + 9 19 + 3 1 1 + * + - 11 / 4 2 * 8 9 * * 11 6 * 18 15 + + - 15 / 7 16 - 4 16 - * 5 14 17 + * * 2 14 + 10 5 - * 10 1 * 5 * * * * -'
expect -7148 '15 8 16 - 19 8 + * * 11 * 10 5 - / 20 -'
expect -160065 '15 8 * 5 / 20 13 + 5 3 * 4 16 + + + 14 4 / + 5 14 + 2 14 + + 16 14 17 16 * + * * - +'
expect 1211760 '10 16 1 18 + 2 * + * 1 * 16 9 * 7 16 6 - 20 10 + * * + *'
expect 26 '8 8 6 - 19 8 / * + 7 19 / 2 7 - * 10 12 - 9 11 * / * * 9 + 17 3 15 16 / 12 10 * * + 17 8 + 18 6 + + 15 8 13 * * + / + +'
expect -244368 '7 8 1 15 / + + 14 14 * 10 16 + 16 19 - * * + 1 11 + 16 5 * * 19 18 + 8 / / 4 2 11 / 7 18 + * * * + 16 *'
expect -15 '11 17 2 + 20 12 / * 10 6 + 12 1 - / * 9 / 2 3 + 12 / 19 7 - 13 9 - - + 18 6 / * + -'
expect 15325020048 '8 10 * 15 12 + * 3 17 / 19 16 + * - 16 4 / 17 17 * / 6 16 + 7 13 + + * - 12 20 + 12 3 * + 8 9 * 20 18 * * - 19 15 13 * 16 10 * * * * - 6 18 + 6 8 + * 9 * 18 8 20 * - * 9 / +'
expect -180 '15 4 16 - *'
expect 28 '11 5 8 + 13 7 + 2 10 + * 17 11 - 15 18 + * / - + 5 +'
expect -134680 '14 20 18 15 / - * 10 13 / 15 10 - + 12 + 14 12 + 14 8 + * 5 - * 13 1 + * -'
expect 761 '1 13 * 15 20 / 4 * 17 20 / 7 13 / * + 18 10 + 11 2 * * 1 11 12 * * + + 13 12 - / +'
expect 5217 '16 17 2 / 7 7 * / 14 7 + 10 19 * + * 13 8 * 10 7 / + 12 9 - * + * 16 11 * 1 + +'
expect 2958 '14 15 + 8 13 * * 3 + 2 18 15 * 2 6 - * * + 5 19 15 - 1 18 + * - 1 18 8 * / 2 12 * 4 18 + + - - / 15 6 17 4 5 - / * + *'
expect 160 '10 9 1 / 18 17 * + 9 20 + 18 19 / + * 15 17 * 19 18 + * 10 + / - 16 *'
expect 143 '11 13 *'
expect 1848 '12 20 / 9 18 + - 9 20 / 3 - - 17 / 16 11 12 18 + + / 7 12 * 3 * 11 2 + + + + 7 *'
expect 975555836 '12 16 - 15 11 - 20 3 + * 1 4 + * - 14 20 + 13 20 / * 3 10 / 19 8 + - + 5 18 + 15 18 * - 2 14 * 16 19 * * * + * 16 8 - 12 10 * - 17 20 * 13 3 - - / 12 / 3 9 + + +'
expect -4201473 '10 4 16 20 - * 2 + 3 1 + 17 10 * - 12 + / + 19 7 * 1 12 + * 9 18 * 14 9 / * * 15 * 13 + -'
expect 32 '17 15 +'
expect 70570 '6 2 + 8 4 * + 16 16 10 + + * 14 19 6 - - 12 19 + 7 17 + / * + 4 2 + 5 11 + + 3 10 + + 7 + * 8 18 + 6 + -'
expect -577590 '10 1 18 * + 17 18 * 10 19 - * * 2 / 14 11 / 1 18 / * 16 17 * 16 18 * / * 5 10 * + + 15 *'
expect -5315 '6 15 * 11 9 * + 16 9 * 6 11 + + * 11 10 + 14 - 7 2 1 + * - / 3 20 12 + 7 19 + * 17 18 / 16 11 * - + - + 1 8 - 11 / 19 8 / 8 17 + / * 15 6 + 4 + 11 9 + 18 19 * / * + 17 16 + 8 - 19 20 + 4 1 * * - 19 * + +'
expect -1624 '12 2 17 * * 11 8 * 6 + + 7 - 16 4 / 17 + 4 1 * 15 4 + * - 19 * + 12 9 - 17 11 - - 1 17 + 16 9 + + / 15 20 + 20 7 / - 1 9 - 16 7 / / * + 16 1 9 - - 13 16 + 6 4 + * + 18 5 17 * - 7 3 - 13 + / * + +'
expect 925 '5 18 11 / 18 6 / + 6 20 9 * + * 11 16 9 * 8 16 * - * + 11 20 / 2 10 * 15 - 5 2 * 8 18 / + / * + +'
expect 4647 '12 1 11 + 1 17 + + 13 15 + 2 5 - + + - 20 11 + 13 11 * * 6 + 12 13 * 12 11 + - 3 10 + + + + 6 9 + 7 * +'
expect 3616 '16 1 5 * * 14 11 / 12 11 18 - + / + 1 16 7 + 3 18 + + + * 16 +'
expect 38672 '10 19 * 13 10 / + 4 + 2 17 + 20 16 / + 11 14 * 14 + + * 6 17 9 * - + 17 9 13 / 4 13 * + 17 2 + 8 5 * / * 3 2 + 12 16 / - 8 10 - 11 6 * * + + * -'
expect -46794 '2 11 13 + 7 5 * * 5 7 + 12 7 * * + 17 13 + 7 3 * * 12 8 * 10 2 * / * - * 11 5 19 3 * * + 9 17 + 3 / 18 13 / - + 15 10 * * -'
expect 25494 '13 14 19 18 * 3 2 + - * + 13 10 17 / 1 11 + + 2 11 - 2 + * - * 18 /'
expect 24 '15 9 +'
expect 75 '3 5 2 * 11 4 + / 6 + 12 * + 1 *'
expect -4 '3 7 -'
expect 14 '14 4 9 / 13 / 18 2 14 - / 6 9 * 9 14 * + * / 4 12 18 * 15 20 * - + 6 5 + 9 8 + / 6 20 + 15 19 - / / * * -'
expect 161 '18 14 * 2 / 3 15 * 10 - + 1 / 12 9 * 17 + 2 - 1 14 4 + 5 11 * + * / * 1 5 - 9 2 * + 1 15 * 16 * - 16 7 + 4 5 * + 9 16 - 16 - * / 16 10 / + *'
expect 143 '17 2 10 8 13 + 8 / + + 9 * +'
expect 1414 '15 12 + 15 17 11 - 18 5 - * + + 19 - 14 20 16 * 6 12 - * 6 2 * 7 15 / * * 1 19 + 16 3 / - 20 15 12 * - * * - *'
expect 7112 '7 20 18 * 2 2 + + 16 16 - 5 13 + + * 1 4 19 + - 11 19 6 * + + + 2 15 15 * * + +'
expect 9 '10 6 12 + 18 / + 9 8 * 14 * 17 2 10 - / / / 17 4 - 1 * 1 4 * 12 3 - / - 17 11 / 19 16 + + 14 4 / 9 4 - * / + / 11 5 - 1 4 + * 13 15 - 4 * - 13 17 * - 19 / -'
expect -9172 '4 8 17 - 9 20 / + 1 + 11 19 5 + * 3 1 * 7 * + * 13 - *'
expect -9320 '13 1 12 / 19 5 + * 5 19 * 5 19 * * + 9 1 15 * 5 13 - * - + - 10 17 - 18 6 - - 11 12 + 6 8 * + - 10 14 + 3 14 / - 19 19 + 7 11 + + * - 8 / +'
expect 387 '15 16 11 14 / - - 16 7 4 13 + + * + 6 + 19 11 9 * 8 14 / * 17 + * 16 3 1 16 + 10 8 + + * + / -'
expect 4 '8 2 /'
expect 1049625 '15 5 * 8 12 * 2 * 8 10 + 5 11 * + * 15 1 + 3 13 + / 3 1 / 15 19 + - + + 18 6 * 4 9 * / 3 3 3 - + / 8 + + *'
expect 40 '10 4 *'
expect 21 '7 7 8 + 17 17 / - 1 2 / 5 20 + * + 1 3 + 20 9 - - 16 / - + 17 13 * 2 4 + * 3 14 / 13 8 * * * 19 7 - 1 9 - * 16 8 + 4 1 * / - * 9 17 5 / * 17 * 1 1 2 * - 6 4 12 - + * + * +'
expect 80006 '17 11 13 + 14 6 - * 11 - 4 14 20 + + 8 10 5 + * * + * 9 17 17 * / 19 / 8 1 * 17 - 16 18 + 9 / / + 20 20 * 5 5 * + 19 5 + 7 1 - * * 17 6 + 4 + 9 10 + 13 9 - * + / + -'
expect 228 '11 16 * 16 + 17 + 14 16 16 / * 19 12 - 11 6 - / - + 9 - 1 14 + +'
expect 7846 '20 12 11 / 15 10 + + 6 15 * 13 18 * / + 9 19 - 20 13 * 3 * * - + 4 13 20 - 16 17 + * 5 + 10 13 9 * * 9 6 * 14 2 + + * / * -'
expect 28012204 '18 7 5 - 10 10 * + * 8 + 20 5 + 2 13 * + 7 * 11 11 + 9 5 + - 7 19 * 3 6 * * * / + 17 13 + 13 18 * * 12 5 / 1 10 / - * 9 17 + 10 10 + + 18 12 + 20 2 * - / + 6 7 9 + 12 1 * * * 3 + + *'
expect 0 '8 15 8 + 12 12 16 + * 13 - * * 1 20 1 * - 12 14 + + 18 6 * 7 6 / + 9 + / 10 / *'
expect 0 '19 16 10 8 + / 14 - 15 * + 1 14 + 12 20 + * 1 + 7 * 14 11 + 7 * 18 9 / 17 4 * + * 14 5 17 + / 5 - + / *'
expect 11 '7 4 +'
expect 0 '5 14 - 4 6 + + 19 20 - 3 12 / * * 6 + 8 4 15 - + 6 18 + 10 7 / + * 12 15 17 - - 19 15 14 + * * * * 12 17 14 + / 16 * 5 12 + 18 19 + + 11 11 / 15 13 * * * - 9 18 12 / 15 - 15 2 * 5 5 + + * / * *'
expect 54001 '8 7 / 1 16 + 12 16 + + 6 / 16 - 10 6 2 2 + + 12 5 * 4 3 - / * * * -'
expect -35126 '17 4 9 * / 9 15 / 9 * * 4 8 9 + 11 6 - / + + 5 3 14 * 6 * 20 9 + * * - 3 9 + 20 + 13 2 / 17 - * 4 * 1 + -'
expect 138600 '13 12 4 - 13 * 3 + + 7 * 11 15 14 15 20 + - 14 14 * 7 9 + + / + * *'
expect -1170 '5 18 * 4 10 13 + / 10 12 13 + - 4 - + 2 14 4 / 9 20 * + 2 14 + 16 13 + + / + + *'
expect 768600 '15 11 19 - 6 + 6 * * 9 9 5 * 5 4 * * * 19 * + 5 *'
expect 2977 '7 7 20 - + 2 + 20 10 * 7 18 6 - + + - 6 + 4 17 5 - 6 19 * + 19 + * 16 8 8 * 7 14 * + * 13 10 * 18 9 + 4 1 / * - + + +'
expect -1 '16 2 10 - 15 2 * / * 17 1 - 2 + 18 17 - * - 2 - 1 14 + /'
expect 0 '13 7 5 18 * 6 8 + 4 16 + + + - 19 18 / 3 8 * 15 + + 2 / * /'
expect 2193 '13 15 / 6 2 / + 16 1 / 10 3 + / - 11 * 18 6 1 * + 5 1 * 18 10 / + + 11 10 + 2 - 10 8 * + + * 14 14 - 20 13 + 16 17 5 / + * + 18 + -'
expect 0 '10 7 11 6 * 6 13 - * * 7 2 / 3 12 - / 2 * * * 18 /'
expect 4274110 '5 20 + 15 - 9 20 + 20 6 * 14 + - / 4 7 17 / 7 10 * + * 11 / + 3 10 * 9 12 + + 12 7 + 8 * - 11 15 11 - 20 5 * + * - 6 14 + 8 + 10 16 7 * + * 17 + * -'
expect 67634804 '11 4 / 13 6 * 7 9 - + + 6 9 * 14 16 * 16 1 - + + + 3 12 / 1 13 * 18 10 / / - 14 7 + 11 10 * * 8 8 / 14 5 * * + + - 13 19 6 - / 5 9 * 16 2 * + * 20 4 11 + 9 3 / * * * 2 4 1 + - 10 5 + 9 17 * / + 20 12 + 3 19 * + 6 1 + 11 7 + - * - * +'
expect 179 '18 6 10 20 * 17 - 2 1 + 17 7 * / + + 2 8 * 11 / 6 7 3 / * + 15 + - +'
expect 1933 '17 8 * 14 * 16 13 + +'
expect -1801 '12 2 20 20 + 5 9 * * 8 + 14 2 / + - +'
expect -10907 '5 18 12 + 5 20 + - 11 17 - 4 5 * / * 10 4 2 * - 14 19 + 3 - + + 7 4 - 16 10 * * 9 1 18 - * + 14 + * -'
expect 71352 '3 8 18 + 5 18 * 19 11 + / - + 3 19 + 15 10 + + 19 16 + 17 * * 19 11 + 11 * 8 8 3 - * * + * 15 /'
expect 414 '18 7 10 8 + + 11 4 + 11 16 / + - 15 + 2 - *'
expect 42 '14 3 *'
expect 228 '12 18 5 9 / * 2 17 - 19 + * 7 / 19 + *'
expect 2882 '16 14 6 / * 8 20 * 14 4 + * + 11 1 * 13 19 + / 10 7 / 18 - * - 17 + 13 6 10 * - +'
expect -252 '15 1 - 18 15 16 / * 3 5 / 10 14 * * + + 12 13 3 * 11 7 + - 4 7 + 3 9 + - - * - 2 -'
expect 0 '15 18 19 7 - / 6 10 * 11 5 - * * 1 10 16 * * 16 * - * 17 9 9 * 18 * + 18 20 7 5 - * * - 15 9 * 7 11 - + 2 9 1 + * * 16 8 * 7 15 * / 19 2 + 17 16 / + / * * *'
expect -2 '16 1 2 + 5 15 * * 1 11 + 14 7 * * + * 20 5 * 3 20 17 + 9 - * + + 3 15 10 - - 15 10 * 12 4 + + * 1 8 * 11 11 / * 10 19 + 19 9 - + + / 16 1 / 16 5 * 12 4 + - 19 15 15 / - + * * /'
expect -5628 '6 18 13 - 7 13 * + 3 14 - 13 12 / + * 4 16 + 14 16 + 19 7 + - + + 12 14 - + *'
expect -3519473 '3 11 17 * 17 17 * * 20 / + 9 11 18 / 10 1 * + + 5 2 16 + / 11 6 * 12 / + * * 6 13 - 11 + 7 2 * 12 7 / - * 10 6 20 + + 8 14 + 8 15 * + + * 15 16 + 2 2 - * 3 2 5 + * - 7 19 * 3 * 11 14 - 7 16 - + + - * +'
expect 4354 '7 16 / 2 10 8 / 8 + 17 17 - 5 / * * - 19 16 18 9 + * 2 8 + 6 12 / - * 15 + + +'
expect 12 '17 4 11 7 * * 15 18 + 16 14 + - * 1 20 10 4 + * / * + 5 -'
expect 1802564 '9 17 13 + + 17 14 * 20 6 - * + 8 * 16 18 3 + 4 9 / * 4 12 * + + * 16 8 - 11 + 14 * 18 16 8 / 14 + * * 4 + +'
expect 486 '18 9 20 11 17 + 4 16 / - * / 15 12 + + *'
expect 191 '8 3 12 * 12 * 18 4 + 1 10 + / / 20 - 13 - +'
expect 0 '10 9 - 19 / 12 8 - 9 19 / + - 16 / 5 12 - 13 2 - - 14 * 17 1 6 * 15 17 / * + * / 17 5 9 8 / + / 1 2 - 6 3 - * 12 15 * 12 10 + / * + 7 18 1 - 5 + * 7 6 / 14 6 + + 9 9 - 6 4 - * * + + *'
expect -964 '10 6 4 * 16 + + 4 17 + / 3 13 - 15 20 + * 13 + 3 3 5 + + 12 15 2 + * - - * 10 2 18 11 + 18 20 * - 3 4 + 5 + - * + +'
expect -41 '20 15 4 * / 3 * 7 10 2 + 13 5 - + * * 14 - 19 18 + 3 - 17 14 / + 4 14 6 + 16 12 - / - * 8 + +'
expect 26002726176 '5 2 * 19 14 - 18 10 + / 18 8 * 3 16 * * + 8 13 * 12 16 * * 12 19 * 17 * * - - 14 9 3 20 + + 8 12 / 14 6 * * * + 3 8 * * *'
expect -630 '18 12 + 19 9 + 4 * 9 - 8 20 * + 4 18 / 1 18 / * 17 6 / 5 7 + + - 13 6 / + / *'
expect 20 '13 7 +'
expect -1811136700 '5 4 16 + 9 11 + + + 15 + 12 1 + 12 13 + + 20 19 + 14 16 - * + 11 8 * 19 6 - * 15 3 - 6 17 - + / * + 11 17 19 11 * * 4 - * 16 3 17 - 5 5 * - 15 7 + 12 3 - / + * - *'
expect 0 '10 7 4 + 17 + 10 11 - 3 15 + * - * 7 20 2 / 11 5 * / 10 11 * 5 6 / * + * * 13 *'
expect -40 '15 9 17 4 / 9 7 / + 20 14 - 3 15 - + * 16 - - -'
expect 0 '6 12 13 7 * 13 / / 3 6 / 16 20 + + 14 - + / 4 14 15 13 / 13 * * 20 11 16 + 1 16 * + - + / *'
expect_error '2 2' # malformed expression - too few operators
expect_error '1 +' # malformed expression - too few operands (stack underflow)
expect_error '1 -'
expect_error '1 *'
expect_error '1 /'
expect_error '1 	*'
expect_error '93203432 0 /' # division by 0
expect_error '93a34 2 +' # illegal character
expect_error '1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 + + + + + + + + + + + + + + + + + + + +' # stack overflow
expect 20 '1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 + + + + + + + + + + + + + + + + + + +' # push stack to its limit

#######################################################################
# End of tests
#######################################################################

# Summarize results
echo "$numPassed/$numAttempted tests passed"
if [ $numPassed -eq $numAttempted ]; then
	exit 0
else
	exit 1
fi
